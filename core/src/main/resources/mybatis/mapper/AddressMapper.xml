<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="liga.medical.personservice.core.repository.AddressRepository">

    <resultMap id="addressEntity" type="liga.medical.personservice.core.model.AddressEntity" autoMapping="true">
        <id property="id" column="id" jdbcType="BIGINT"/>
    </resultMap>

    <select id="findByIds" resultMap="addressEntity">
        <bind name="" value=""/>
        SELECT id, contact_id, country_id, city, index, street, building, flat
        FROM address
        <choose>
            <when test="addressIds.isEmpty()">
                ORDER BY recovery_dt DESC
                LIMIT 10;
            </when>
            <otherwise>
                WHERE id IN
                <foreach collection='addressIds' item='id' open='(' separator=',' close=')'>
                    #{id, jdbcType=BIGINT}
                </foreach>
            </otherwise>
        </choose>
    </select>

    <insert id="insertAll" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        INSERT INTO address (contact_id, country_id, city, index, street, building, flat) VALUES
        <foreach collection="addressList" item="address" separator=",">
            (#{address.contactId, jdbcType=BIGINT}, #{address.countryId, jdbcType=BIGINT},
            #{address.city, jdbcType=VARCHAR(255)}, #{address.index,jdbcType=INTEGER},
             #{address.street,jdbcType=VARCHAR(255)}, #{address.building,jdbcType=VARCHAR(32)},
             #{address.flat,jdbcType=VARCHAR(32)})
        </foreach>
    </insert>

    <update id="updateById" parameterType="liga.medical.personservice.core.model.AddressEntity">
        <if test="id != null">
            UPDATE address SET
            <if test="contactId != null">
                contact_id = #{contactId},
            </if>
            <if test="countryId != null">
                country_id = #{countryId},
            </if>
            <if test="city != null">
                city = #{city},
            </if>
            <if test="index != null">
                index = #{index},
            </if>
            <if test="street != null">
                street = #{street},
            </if>
            <if test="building != null">
                building = #{building},
            </if>
            <if test="flat != null">
                flat = #{flat},
            </if>
            WHERE id = #{id};
        </if>
    </update>

    <delete id="deleteById">
        DELETE
        FROM address
        WHERE case_id = #{addressId,jdbcType=BIGINT};
    </delete>
</mapper>